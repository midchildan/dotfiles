# vim:set et sw=2 ts=8 ft=zsh:

local cmd="command find -L . \\( -path '*/\\.*' -o -fstype 'dev' -o -fstype 'devtmpfs' -o -fstype 'proc' \\) -prune \
  -o -type d -print 2> /dev/null | sed 1d | cut -b3-"

setopt localoptions pipefail 2> /dev/null
local dir="${$(eval "$cmd | fzf-tmux +m $FZF_CD_OPTS"):-.}"
if [[ -z "$dir" ]]; then
  zle redisplay
  return 0
fi
cd "$dir"
local ret=$?

zle reset-prompt
typeset -f zle-line-init >/dev/null && zle zle-line-init
return $ret
